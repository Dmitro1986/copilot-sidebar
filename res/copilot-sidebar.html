<!-- copilot-sidebar.html -->

<script type="text/javascript">
    (function() {
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Node-RED
        RED.events.on("runtime-event", function(event) {
            if (event.id === "runtime-state" && event.payload === "start") {
                initializeCopilotSidebar();
            }
        });

        // –ï—Å–ª–∏ runtime —É–∂–µ –∑–∞–ø—É—â–µ–Ω
        if (RED.state && RED.state() === "start") {
            setTimeout(initializeCopilotSidebar, 1000);
        }

        function initializeCopilotSidebar() {
            // –°–æ–∑–¥–∞–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å
            const copilotSidebar = $('<div id="copilot-sidebar-content"></div>');
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å –≤ sidebar
            RED.sidebar.addTab({
                id: "copilot",
                label: "Copilot",
                name: "ü§ñ Copilot",
                content: copilotSidebar,
                closeable: false,
                visible: true,
                iconClass: "fa fa-magic"
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –ø–∞–Ω–µ–ª–∏
            loadCopilotResources();
            
            console.log("ü§ñ Copilot sidebar initialized");
        }

        function loadCopilotResources() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º CSS
            if (!$('#copilot-sidebar-css').length) {
                $('<link>')
                    .attr('rel', 'stylesheet')
                    .attr('type', 'text/css')
                    .attr('id', 'copilot-sidebar-css')
                    .attr('href', 'copilot-sidebar/resources/copilot-panel.css')
                    .appendTo('head');
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π
            const loadModelsConfig = () => {
                return $.getScript('copilot-sidebar/resources/models-config.js');
            };

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥–µ–ª–µ–π
            const loadModelManager = () => {
                return $.getScript('copilot-sidebar/resources/model-manager.js');
            };

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π JS
            const loadMainPanel = () => {
                return $.getScript('copilot-sidebar/resources/copilot-panel.js');
            };

            // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
            loadModelsConfig()
                .then(loadModelManager)
                .then(loadMainPanel)
                .done(function() {
                    console.log("‚úÖ Copilot panel resources loaded");
                    initializeCopilotPanel();
                })
                .fail(function() {
                    console.error("‚ùå Failed to load Copilot panel resources");
                });
        }

        function initializeCopilotPanel() {
            if (window.CopilotPanel) {
                window.copilotPanel = new CopilotPanel('copilot-sidebar-content');
                window.copilotPanel.initialize();
            }
        }
    })();
</script>

<script type="text/html" data-template-name="copilot-sidebar">
    <!-- –°–∫—Ä—ã—Ç—ã–π —É–∑–µ–ª, –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø–∞–ª–∏—Ç—Ä–µ -->
    <div style="display: none;">
        <div class="form-row">
            <label>Copilot Sidebar Plugin</label>
        </div>
    </div>
</script>

<script type="text/html" data-help-name="copilot-sidebar">
    <p>ü§ñ Copilot Sidebar Plugin –¥–ª—è Node-RED</p>
    <p>–î–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –ø–∞–Ω–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞ –≤ –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å Node-RED.</p>
</script>

<style>
    /* –°–∫—Ä—ã–≤–∞–µ–º —ç—Ç–æ—Ç —É–∑–µ–ª –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã */
    .red-ui-palette-node[data-palette-type="copilot-sidebar"] {
        display: none !important;
    }
</style>
